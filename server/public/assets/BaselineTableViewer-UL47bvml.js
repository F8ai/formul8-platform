import{r as i,u as qe,t as Ee,m as ne,v as Re,j as e,B as u,R as D,C as re,a as ie,b as de,d as ce,f as R,o as Te,I as z,ah as O,Y as T,_ as I,$ as M,a0 as F,a1 as o,ai as Ie,a7 as Me,a6 as Fe,D as P,an as $e,ao as Ae,ap as Be,aq as _e,a3 as Le}from"./index-CDF1r-gK.js";import{T as Qe,a as De,b as J,c as $,d as ze,e as w}from"./table-BtQ_kS4p.js";import{S as U}from"./square-pen-D1rxitn8.js";import{S as G}from"./save-BBPmqZUn.js";function Ge({agentType:oe}){new URLSearchParams(window.location.search);const xe=window.location.pathname.split("/"),c=oe||xe[2]||"compliance",[m,V]=i.useState(""),[p,K]=i.useState("all"),[j,H]=i.useState("all"),[b,X]=i.useState("all"),[y,Y]=i.useState("all");i.useState(new Set);const[ue,A]=i.useState(!1),[W,Z]=i.useState(""),[v,B]=i.useState(new Set),[ee,k]=i.useState({}),[me,he]=i.useState(new Set),{toast:N}=qe(),ge=Ee(),{data:S=[],isLoading:fe,refetch:Q}=ne({queryKey:["/api/agents",c,"baseline-results"],queryFn:async()=>{console.log(`Loading baseline results for agent: ${c}`);const s=await fetch(`/api/agents/${c}/baseline-results`);if(s.ok){const t=await s.json();return console.log(`Loaded ${t.length} questions for ${c} agent`),t}else return console.error(`Failed to load baseline results for ${c}:`,s.status),[]},enabled:!!c});console.log(`BaselineTableViewer loaded for ${c} agent with ${S.length} questions`);const{data:se,refetch:pe}=ne({queryKey:["/api/agents",c,"baseline-json"],queryFn:async()=>{const s=await fetch(`/api/agents/${c}/baseline-json`);if(s.ok)return await s.json();throw new Error("Failed to load baseline.json")},enabled:!1}),_=Re({mutationFn:async s=>{const t=await fetch(`/api/agents/${c}/baseline-json`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw new Error("Failed to save baseline");return await t.json()},onSuccess:s=>{N({title:"Baseline saved successfully",description:s.message}),A(!1),ge.invalidateQueries({queryKey:["/api/agents",c,"baseline-results"]}),Q()},onError:s=>{N({title:"Failed to save baseline",description:s.message||"Unknown error occurred",variant:"destructive"})}}),je=async()=>{try{await pe(),se&&(Z(JSON.stringify(se,null,2)),A(!0))}catch{N({title:"Failed to load baseline",description:"Could not load baseline.json for editing",variant:"destructive"})}},be=()=>{try{const s=JSON.parse(W);_.mutate(s)}catch{N({title:"Invalid JSON",description:"Please check your JSON syntax",variant:"destructive"})}},h=i.useMemo(()=>!S||S.length===0?[]:S.map(s=>({...s,modelResponses:s.modelResponses||[]})),[S]),C=i.useMemo(()=>{const s=[];return h.forEach(t=>{t.modelResponses&&t.modelResponses.length>0?t.modelResponses.forEach(l=>{s.push({questionId:t.id,question:t.question,expected_answer:t.expected_answer,category:t.category,difficulty:t.difficulty,state:t.state||"MULTI",model:l.model,ragEnabled:l.model.includes("rag")||!1,knowledgeBase:l.model.includes("kb")?"Cannabis KB":"Standard",response:l})}):s.push({questionId:t.id,question:t.question,expected_answer:t.expected_answer,category:t.category,difficulty:t.difficulty,state:t.state||"MULTI",model:"No test run",ragEnabled:!1,knowledgeBase:"N/A",response:{model:"No test run",answer:'Click "Run Test" to generate response',confidence:0,grade:0,gradingConfidence:0,status:"pending"}})}),s},[h]),g=i.useMemo(()=>{const s=new Set;return h.forEach(t=>{var l;(l=t.modelResponses)==null||l.forEach(n=>{s.add(n.model)})}),Array.from(s).sort()},[h]),ye=i.useMemo(()=>{const s={};return g.forEach(t=>{const l=h.flatMap(n=>{var a;return((a=n.modelResponses)==null?void 0:a.filter(x=>x.model===t&&x.cost&&x.cost>0))||[]});s[t]={totalCost:l.reduce((n,a)=>n+(a.cost||0),0),avgResponseTime:l.length>0?l.reduce((n,a)=>n+(a.responseTime||0),0)/l.length:0,avgGrade:l.length>0?l.reduce((n,a)=>n+a.grade,0)/l.length:0,testCount:l.length}}),s},[h,g]),q=i.useMemo(()=>C.filter(s=>{const t=!m||s.question.toLowerCase().includes(m.toLowerCase())||s.expected_answer.toLowerCase().includes(m.toLowerCase())||s.response.answer.toLowerCase().includes(m.toLowerCase()),l=!p||p==="all"||s.difficulty===p,n=!j||j==="all"||s.state===j,a=!b||b==="all"||s.model===b,x=!y||y==="all"||s.category===y;return t&&l&&n&&a&&x}),[C,m,p,j,b,y]),ve=i.useMemo(()=>{const s=new Set;return C.forEach(t=>{t.state&&s.add(t.state)}),Array.from(s).sort()},[C]),Ne=i.useMemo(()=>{const s=new Set;return C.forEach(t=>{t.category&&s.add(t.category)}),Array.from(s).sort()},[C]),ae=i.useMemo(()=>{const s={},t={};return q.forEach(l=>{const n=`${l.questionId}`;t[n]||(t[n]=[]),t[n].push(l)}),Object.values(t).forEach(l=>{const n=l[0],a=n.category||"Uncategorized";s[a]||(s[a]=[]);const x={...n,allModelResponses:l.map(f=>f.response)};s[a].push(x)}),s},[q]),Ce=s=>{switch(s){case"basic":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"intermediate":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"advanced":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},L=(s,t)=>{B(l=>new Set(l).add(s)),k(l=>({...l,[s]:{question:t.question,expected_answer:t.expected_answer,category:t.category,difficulty:t.difficulty,state:t.state}}))},te=s=>{B(t=>{const l=new Set(t);return l.delete(s),l}),k(t=>{const l={...t};return delete l[s],l})},le=async s=>{const t=ee[s];if(t)try{if(!(await fetch(`/api/agents/${c}/baseline-questions/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("Failed to update question");N({title:"Question updated",description:"The baseline question has been saved successfully."}),te(s),Q()}catch(l){N({title:"Failed to update question",description:l instanceof Error?l.message:"Unknown error occurred",variant:"destructive"})}},E=(s,t,l)=>{k(n=>({...n,[s]:{...n[s],[t]:l}}))},we=s=>{he(t=>{const l=new Set(t);return l.has(s)?l.delete(s):l.add(s),l})},ke=s=>me.has(s);return e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Baseline Questions with Model Responses"}),e.jsxs("p",{className:"text-muted-foreground",children:["Showing results for ",g.length," models: ",g.join(", ")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{onClick:je,variant:"outline",size:"sm",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Edit Baseline"]}),e.jsxs(u,{onClick:()=>Q(),variant:"outline",size:"sm",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),g.length>0&&e.jsxs(re,{children:[e.jsxs(ie,{children:[e.jsx(de,{className:"text-lg",children:"Model Performance & Cost Metrics"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Real-time costs and performance from actual API calls"})]}),e.jsx(ce,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:g.map(s=>{const t=ye[s],l=h.some(n=>{var a;return(a=n.modelResponses)==null?void 0:a.some(x=>x.model===s&&x.status==="success")});return e.jsxs("div",{className:`border rounded-lg p-4 ${l?"bg-muted/30":"bg-yellow-50/50 opacity-70"}`,children:[e.jsxs("div",{className:"font-medium text-sm mb-3 text-center flex items-center justify-center gap-1",children:[s,!l&&e.jsx(R,{variant:"outline",className:"text-xs bg-yellow-100 text-yellow-700 border-yellow-300",children:"SIMULATED"})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tests:"}),e.jsx("span",{className:"font-medium",children:t.testCount})]}),t.totalCost>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Cost:"}),e.jsxs("span",{className:`font-medium ${l?"text-green-600":"text-yellow-600"}`,children:["$",t.totalCost.toFixed(4),!l&&e.jsx("span",{className:"text-xs ml-1",children:"(est.)"})]})]}),t.avgGrade>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Grade:"}),e.jsxs(R,{variant:t.avgGrade>=80?"default":t.avgGrade>=60?"secondary":"destructive",className:"text-xs",children:[t.avgGrade.toFixed(1),"%",!l&&e.jsx("span",{className:"ml-1",children:"(sim.)"})]})]}),t.avgResponseTime>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Time:"}),e.jsxs("span",{className:`font-medium ${l?"text-blue-600":"text-yellow-600"}`,children:[(t.avgResponseTime/1e3).toFixed(1),"s",!l&&e.jsx("span",{className:"text-xs ml-1",children:"(est.)"})]})]})]})]},s)})})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Te,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search questions...",value:m,onChange:s=>V(s.target.value),className:"pl-10"})]}),(m||p!=="all"||j!=="all"||b!=="all"||y!=="all")&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{V(""),K("all"),H("all"),X("all"),Y("all")},children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"Clear"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsxs(T,{value:y,onValueChange:Y,children:[e.jsx(I,{className:"w-40",children:e.jsx(M,{placeholder:"All Categories"})}),e.jsxs(F,{children:[e.jsx(o,{value:"all",children:"All Categories"}),Ne.map(s=>e.jsx(o,{value:s,children:s},s))]})]}),e.jsxs(T,{value:p,onValueChange:K,children:[e.jsx(I,{className:"w-32",children:e.jsx(M,{placeholder:"Difficulty"})}),e.jsxs(F,{children:[e.jsx(o,{value:"all",children:"All"}),e.jsx(o,{value:"basic",children:"Basic"}),e.jsx(o,{value:"intermediate",children:"Intermediate"}),e.jsx(o,{value:"advanced",children:"Advanced"})]})]}),e.jsxs(T,{value:j,onValueChange:H,children:[e.jsx(I,{className:"w-24",children:e.jsx(M,{placeholder:"State"})}),e.jsxs(F,{children:[e.jsx(o,{value:"all",children:"All"}),ve.map(s=>e.jsx(o,{value:s,children:s},s))]})]}),e.jsxs(T,{value:b,onValueChange:X,children:[e.jsx(I,{className:"w-40",children:e.jsx(M,{placeholder:"Model"})}),e.jsxs(F,{children:[e.jsx(o,{value:"all",children:"All Models"}),g.map(s=>e.jsx(o,{value:s,children:s},s))]})]}),e.jsxs(u,{variant:"outline",onClick:()=>{const s=q.map(t=>t.questionId);if(v.size===0){B(new Set(s));const t={};q.forEach(l=>{t[l.questionId]={question:l.question,expected_answer:l.expected_answer,category:l.category,difficulty:l.difficulty,state:l.state}}),k(t)}else B(new Set),k({})},className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),v.size===0?"Edit Mode":"Cancel Edits"]}),v.size>0&&e.jsxs(u,{onClick:()=>{v.forEach(s=>{le(s)})},className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Save All (",v.size,")"]})]}),e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(de,{children:["Questions & Responses (",Object.values(ae).flat().length," questions)"]})}),e.jsx(ce,{children:fe?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(D,{className:"h-4 w-4 animate-spin mr-2"}),"Loading test results..."]}):q.length===0?e.jsx("div",{className:"text-center py-8",children:"No test results found matching the current filters."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Qe,{children:[e.jsx(De,{children:e.jsxs(J,{children:[e.jsx($,{className:"min-w-[500px] max-w-[600px]",children:"Question & AI Responses"}),e.jsx($,{className:"w-24",children:"Category"}),e.jsx($,{className:"w-24",children:"Difficulty"}),e.jsx($,{className:"w-16",children:"State"}),e.jsx($,{className:"w-24",children:"Actions"})]})}),e.jsx(ze,{children:Object.entries(ae).map(([s,t])=>{const l=ke(s),n=t.length;return e.jsxs(Ie.Fragment,{children:[e.jsx(J,{className:"bg-gray-50 dark:bg-gray-900/50 hover:bg-gray-100 dark:hover:bg-gray-800/50",children:e.jsx(w,{colSpan:5,className:"font-semibold",children:e.jsxs("button",{onClick:()=>we(s),className:"flex items-center gap-2 w-full text-left",children:[l?e.jsx(Me,{className:"h-4 w-4"}):e.jsx(Fe,{className:"h-4 w-4"}),s," (",n," question",n!==1?"s":"",")"]})})}),!l&&t.map((a,x)=>{const f=v.has(a.questionId),d=ee[a.questionId];return e.jsxs(J,{className:"border-l-4 border-l-blue-200 dark:border-l-blue-800",children:[e.jsx(w,{className:"min-w-[500px] max-w-[600px] align-top",children:f?e.jsxs("div",{className:"space-y-3 p-3 border-2 border-blue-200 dark:border-blue-800 rounded-lg bg-blue-50/30 dark:bg-blue-900/20",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-blue-700 dark:text-blue-300 mb-2 block",children:"Question:"}),e.jsx(P,{value:(d==null?void 0:d.question)||a.question,onChange:r=>E(a.questionId,"question",r.target.value),className:"text-sm border-blue-300 focus:border-blue-500",rows:3,placeholder:"Enter your question..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-blue-700 dark:text-blue-300 mb-2 block",children:"Expected Answer:"}),e.jsx(P,{value:(d==null?void 0:d.expected_answer)||a.expected_answer,onChange:r=>E(a.questionId,"expected_answer",r.target.value),className:"text-sm border-blue-300 focus:border-blue-500",rows:4,placeholder:"Enter the expected answer..."})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Question:"}),e.jsx("p",{className:"text-sm leading-relaxed",children:a.question})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Expected Answer:"}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:a.expected_answer})]}),e.jsxs("div",{className:"border-t pt-3 mt-3",children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 text-blue-700 dark:text-blue-300",children:["🤖 AI Responses",a.allModelResponses&&a.allModelResponses.length>0?` (${a.allModelResponses.length} model${a.allModelResponses.length!==1?"s":""})`:"",":"]}),a.allModelResponses&&a.allModelResponses.length>0?e.jsx("div",{className:"space-y-3",children:a.allModelResponses.map((r,Se)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-gray-50/50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:r.model}),r.grade!==void 0&&e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${r.grade>=80?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":r.grade>=60?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:["Grade: ",r.grade.toFixed(1),"%"]})]}),r.cost&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Cost: $",r.cost.toFixed(4)]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-700 rounded p-3",children:e.jsx("p",{className:"text-sm leading-relaxed text-gray-800 dark:text-gray-200",children:r.answer||"No response generated"})}),r.responseTime&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:["Response time: ",(r.responseTime/1e3).toFixed(1),"s"]})]},`${a.questionId}-${r.model}-${Se}`))}):e.jsxs("div",{className:"p-4 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No AI responses available"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Run baseline tests to generate AI responses"})]})]})]})}),e.jsx(w,{className:"align-top",children:f?e.jsx("div",{className:"p-2 border border-blue-200 rounded bg-blue-50/20 dark:bg-blue-900/10",children:e.jsx(z,{value:(d==null?void 0:d.category)||a.category,onChange:r=>E(a.questionId,"category",r.target.value),className:"text-xs h-8 border-blue-300 focus:border-blue-500",placeholder:"Category"})}):e.jsx(R,{variant:"outline",className:"text-xs cursor-pointer hover:bg-gray-100",onClick:()=>L(a.questionId,{id:a.questionId,question:a.question,expected_answer:a.expected_answer,category:a.category,difficulty:a.difficulty,state:a.state}),children:a.category})}),e.jsx(w,{className:"align-top",children:f?e.jsx("div",{className:"p-2 border border-blue-200 rounded bg-blue-50/20 dark:bg-blue-900/10",children:e.jsxs(T,{value:(d==null?void 0:d.difficulty)||a.difficulty,onValueChange:r=>E(a.questionId,"difficulty",r),children:[e.jsx(I,{className:"h-8 text-xs border-blue-300 focus:border-blue-500",children:e.jsx(M,{})}),e.jsxs(F,{children:[e.jsx(o,{value:"basic",children:"Basic"}),e.jsx(o,{value:"intermediate",children:"Intermediate"}),e.jsx(o,{value:"advanced",children:"Advanced"})]})]})}):e.jsx(R,{variant:"secondary",className:`text-xs cursor-pointer hover:opacity-80 ${Ce(a.difficulty)}`,onClick:()=>L(a.questionId,{id:a.questionId,question:a.question,expected_answer:a.expected_answer,category:a.category,difficulty:a.difficulty,state:a.state}),children:a.difficulty})}),e.jsx(w,{className:"align-top",children:f?e.jsx("div",{className:"p-2 border border-blue-200 rounded bg-blue-50/20 dark:bg-blue-900/10",children:e.jsx(z,{value:(d==null?void 0:d.state)||a.state,onChange:r=>E(a.questionId,"state",r.target.value),className:"text-xs h-8 w-16 border-blue-300 focus:border-blue-500",placeholder:"State"})}):e.jsx(R,{variant:"outline",className:"text-xs cursor-pointer hover:bg-gray-100",onClick:()=>L(a.questionId,{id:a.questionId,question:a.question,expected_answer:a.expected_answer,category:a.category,difficulty:a.difficulty,state:a.state}),children:a.state})}),e.jsx(w,{className:"align-top",children:f?e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u,{size:"sm",onClick:()=>le(a.questionId),className:"h-8 px-2 text-xs",children:e.jsx(G,{className:"h-3 w-3"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>te(a.questionId),className:"h-8 px-2 text-xs",children:e.jsx(O,{className:"h-3 w-3"})})]}):e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>L(a.questionId,{id:a.questionId,question:a.question,expected_answer:a.expected_answer,category:a.category,difficulty:a.difficulty,state:a.state}),className:"h-8 px-2 text-xs",children:e.jsx(U,{className:"h-3 w-3"})})})]},`${a.questionId}-${a.model}`)})]},`category-${s}`)})})]})})})]})]}),e.jsx($e,{open:ue,onOpenChange:A,children:e.jsxs(Ae,{className:"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs(Be,{children:[e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"Edit ",c," baseline.json"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Edit the baseline questions directly. Changes will be saved to the agent's baseline.json file."})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(P,{value:W,onChange:s=>Z(s.target.value),className:"w-full h-[60vh] font-mono text-sm resize-none",placeholder:"Loading baseline.json..."})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Make sure your JSON is valid before saving"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",onClick:()=>A(!1),disabled:_.isPending,children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsx(u,{onClick:be,disabled:_.isPending,children:_.isPending?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]})]})})]})}export{Ge as default};
