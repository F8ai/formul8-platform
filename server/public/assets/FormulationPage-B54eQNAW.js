import{u as ue,r as I,j as e,C as d,a as h,b as x,a3 as me,B as je,d as b,X as a,I as u,Y as m,_ as j,$ as g,a0 as p,a1 as v,b$ as ge,w as pe,f as ve}from"./index-B8YngC3q.js";import{S as fe}from"./save-DK9PuBoI.js";const be=()=>{const[T,V]=I.useState([]),[r,w]=I.useState(!0);return I.useEffect(()=>{(async()=>{try{const C=await fetch("/api/ingredients");if(C.ok){const n=await C.json();V(n)}}catch(C){console.error("Error fetching ingredients:",C)}finally{w(!1)}})()},[]),{ingredients:T,loading:r}},Ce=({title:T="Cannabis Tincture Formulation",onSave:V,initialData:r})=>{var q,L,A,Y;const{toast:w}=ue(),{ingredients:P,loading:C}=be(),[n,l]=I.useState({productName:(r==null?void 0:r.productName)||"Premium CBD Tincture",batchSize:(r==null?void 0:r.batchSize)||100,servingSize:(r==null?void 0:r.servingSize)||1,targetThc:(r==null?void 0:r.targetThc)||5,targetCbd:(r==null?void 0:r.targetCbd)||25,selectedIngredients:(r==null?void 0:r.selectedIngredients)||{},selectedManufacturers:(r==null?void 0:r.selectedManufacturers)||{},concentrations:{terpene:2,flavoring:1,carrierOil:95,...r==null?void 0:r.concentrations},calculations:{cannabinoidVolume:0,cannabinoidMass:0,carrierOilVolume:0,carrierOilMass:0,terpeneVolume:0,terpeneMass:0,flavoringVolume:0,flavoringMass:0,totalCost:0,costPerServing:0,actualThc:0,actualCbd:0,...r==null?void 0:r.calculations}});I.useEffect(()=>{_()},[n.batchSize,n.servingSize,n.targetThc,n.targetCbd,n.selectedIngredients,n.concentrations]);const _=()=>{const{batchSize:s,servingSize:c,targetThc:t,targetCbd:i,selectedIngredients:f,concentrations:N}=n,U=s/c,o=f.cannabinoid,y=f.carrierOil,S=f.terpene,F=f.flavoring,Q=(t+i)*U,J=(o==null?void 0:o.potency)||85,W=(o==null?void 0:o.density)||.95,O=Q/1e3/(J/100),Z=O/W,E=s*N.carrierOil/100,D=(y==null?void 0:y.density)||.915,ee=E*D,H=s*N.terpene/100,se=(S==null?void 0:S.density)||.841,ne=H*se,R=s*N.flavoring/100,re=(F==null?void 0:F.density)||1,ce=R*re,ae=O*((o==null?void 0:o.costPerUnit)||12.5),te=E*((y==null?void 0:y.costPerUnit)||.25),le=H*((S==null?void 0:S.costPerUnit)||45),ie=R*((F==null?void 0:F.costPerUnit)||2.25),X=ae+te+le+ie,oe=X/U,de=O*1e3*(J/100)/U,he=0;l(xe=>({...xe,calculations:{cannabinoidVolume:Z,cannabinoidMass:O,carrierOilVolume:E,carrierOilMass:ee,terpeneVolume:H,terpeneMass:ne,flavoringVolume:R,flavoringMass:ce,totalCost:X,costPerServing:oe,actualThc:de,actualCbd:he}}))},M=(s,c)=>{const t=P.find(i=>i.id===parseInt(c));t&&(l(i=>({...i,selectedIngredients:{...i.selectedIngredients,[s]:t}})),w({title:"Ingredient Updated",description:`Selected ${t.name} for ${s}`}))},$=(s,c)=>{l(t=>({...t,selectedManufacturers:{...t.selectedManufacturers,[s]:c}}))},B=(s,c)=>{l(t=>({...t,concentrations:{...t.concentrations,[s]:c}}))},G=async()=>{try{V&&V(n),(await fetch("/api/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:`${n.productName} - Formulation Sheet`,content:K(),documentType:"formulation-sheet",metadata:n,position:{x:Math.random()*200+50,y:Math.random()*200+50}})})).ok&&w({title:"Formulation Saved",description:"Your formulation has been saved successfully."})}catch(s){console.error("Error saving formulation:",s),w({title:"Save Failed",description:"Failed to save formulation. Please try again.",variant:"destructive"})}},K=()=>{var t,i,f,N;const{calculations:s,selectedIngredients:c}=n;return`= ${n.productName} - Formulation Report
:generated: ${new Date().toISOString()}
:batch-size: ${n.batchSize}ml

== Formulation Summary

*Product:* ${n.productName}
*Batch Size:* ${n.batchSize} ml
*Target THC:* ${n.targetThc} mg/serving
*Target CBD:* ${n.targetCbd} mg/serving

== Ingredients

*Cannabinoid:* ${((t=c.cannabinoid)==null?void 0:t.name)||"Not selected"}
*Carrier Oil:* ${((i=c.carrierOil)==null?void 0:i.name)||"Not selected"}
*Terpene:* ${((f=c.terpene)==null?void 0:f.name)||"Not selected"}
*Flavoring:* ${((N=c.flavoring)==null?void 0:N.name)||"Not selected"}

== Calculations

*Total Batch Cost:* $${s.totalCost.toFixed(2)}
*Cost per Serving:* $${s.costPerServing.toFixed(4)}
*Actual THC:* ${s.actualThc.toFixed(2)} mg/serving
*Calculated THC Variance:* ${((s.actualThc-n.targetThc)/n.targetThc*100).toFixed(1)}%`},z=s=>P.filter(c=>c.category===s);if(C)return e.jsx(d,{className:"w-full max-w-6xl mx-auto",children:e.jsx(h,{children:e.jsx(x,{children:"Loading Formulation Sheet..."})})});const k=(n.calculations.actualThc-n.targetThc)/n.targetThc*100;return e.jsxs("div",{className:"w-full max-w-6xl mx-auto space-y-6",children:[e.jsx(d,{children:e.jsxs(h,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),T]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Interactive cannabis tincture formulation with real-time calculations"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(je,{onClick:G,className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Save Formulation"]})})]})}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Formulation Parameters"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"productName",children:"Product Name"}),e.jsx(u,{id:"productName",value:n.productName,onChange:s=>l(c=>({...c,productName:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"batchSize",children:"Batch Size (ml)"}),e.jsx(u,{id:"batchSize",type:"number",value:n.batchSize,onChange:s=>l(c=>({...c,batchSize:parseFloat(s.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"servingSize",children:"Serving Size (ml)"}),e.jsx(u,{id:"servingSize",type:"number",step:"0.1",value:n.servingSize,onChange:s=>l(c=>({...c,servingSize:parseFloat(s.target.value)}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"targetThc",children:"Target THC (mg/serving)"}),e.jsx(u,{id:"targetThc",type:"number",step:"0.1",value:n.targetThc,onChange:s=>l(c=>({...c,targetThc:parseFloat(s.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"targetCbd",children:"Target CBD (mg/serving)"}),e.jsx(u,{id:"targetCbd",type:"number",step:"0.1",value:n.targetCbd,onChange:s=>l(c=>({...c,targetCbd:parseFloat(s.target.value)}))})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Cannabinoid Extract"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"Extract Type"}),e.jsxs(m,{onValueChange:s=>M("cannabinoid",s),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select cannabinoid extract..."})}),e.jsx(p,{children:z("cannabinoid").map(s=>e.jsxs(v,{value:s.id.toString(),children:[s.name," (",s.potency,"% ",s.potencyUnit,")"]},s.id))})]})]}),n.selectedIngredients.cannabinoid&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(a,{children:"Manufacturer"}),e.jsxs(m,{onValueChange:s=>$("cannabinoid",s),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select manufacturer..."})}),e.jsx(p,{children:(q=n.selectedIngredients.cannabinoid.manufacturers)==null?void 0:q.map(s=>e.jsx(v,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Required Volume:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.cannabinoidVolume.toFixed(3)," ml"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Required Mass:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.cannabinoidMass.toFixed(3)," g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cost:"}),e.jsxs("span",{className:"font-mono",children:["$",(n.calculations.cannabinoidMass*(n.selectedIngredients.cannabinoid.costPerUnit||0)).toFixed(2)]})]})]})]})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Carrier Oil"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"Oil Type"}),e.jsxs(m,{onValueChange:s=>M("carrierOil",s),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select carrier oil..."})}),e.jsx(p,{children:z("carrier-oil").map(s=>e.jsxs(v,{value:s.id.toString(),children:[s.name," (",s.density," g/ml)"]},s.id))})]})]}),n.selectedIngredients.carrierOil&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(a,{children:"Manufacturer"}),e.jsxs(m,{onValueChange:s=>$("carrierOil",s),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select manufacturer..."})}),e.jsx(p,{children:(L=n.selectedIngredients.carrierOil.manufacturers)==null?void 0:L.map(s=>e.jsx(v,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Concentration (%)"}),e.jsx(u,{type:"number",step:"0.1",value:n.concentrations.carrierOil,onChange:s=>B("carrierOil",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Volume:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.carrierOilVolume.toFixed(1)," ml"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mass:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.carrierOilMass.toFixed(3)," g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cost:"}),e.jsxs("span",{className:"font-mono",children:["$",(n.calculations.carrierOilVolume*(n.selectedIngredients.carrierOil.costPerUnit||0)).toFixed(2)]})]})]})]})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Terpene Profile"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"Terpene"}),e.jsxs(m,{onValueChange:s=>M("terpene",s),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select terpene..."})}),e.jsx(p,{children:z("terpene").map(s=>e.jsxs(v,{value:s.id.toString(),children:[s.name," (",s.density," g/ml)"]},s.id))})]})]}),n.selectedIngredients.terpene&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(a,{children:"Manufacturer"}),e.jsxs(m,{onValueChange:s=>$("terpene",s),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select manufacturer..."})}),e.jsx(p,{children:(A=n.selectedIngredients.terpene.manufacturers)==null?void 0:A.map(s=>e.jsx(v,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Concentration (%)"}),e.jsx(u,{type:"number",step:"0.1",value:n.concentrations.terpene,onChange:s=>B("terpene",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Volume:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.terpeneVolume.toFixed(2)," ml"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mass:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.terpeneMass.toFixed(3)," g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cost:"}),e.jsxs("span",{className:"font-mono",children:["$",(n.calculations.terpeneVolume*(n.selectedIngredients.terpene.costPerUnit||0)).toFixed(2)]})]})]})]})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Flavoring"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"Flavoring"}),e.jsxs(m,{onValueChange:s=>M("flavoring",s),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select flavoring..."})}),e.jsx(p,{children:z("flavoring").map(s=>e.jsx(v,{value:s.id.toString(),children:s.name},s.id))})]})]}),n.selectedIngredients.flavoring&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(a,{children:"Manufacturer"}),e.jsxs(m,{onValueChange:s=>$("flavoring",s),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select manufacturer..."})}),e.jsx(p,{children:(Y=n.selectedIngredients.flavoring.manufacturers)==null?void 0:Y.map(s=>e.jsx(v,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Concentration (%)"}),e.jsx(u,{type:"number",step:"0.1",value:n.concentrations.flavoring,onChange:s=>B("flavoring",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Volume:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.flavoringVolume.toFixed(2)," ml"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mass:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.flavoringMass.toFixed(3)," g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cost:"}),e.jsxs("span",{className:"font-mono",children:["$",(n.calculations.flavoringVolume*(n.selectedIngredients.flavoring.costPerUnit||0)).toFixed(2)]})]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"Cost Analysis"]})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{children:"Total Batch Cost:"}),e.jsxs("span",{className:"font-mono text-lg font-semibold",children:["$",n.calculations.totalCost.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{children:"Cost per Serving:"}),e.jsxs("span",{className:"font-mono",children:["$",n.calculations.costPerServing.toFixed(4)]})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Servings per Batch:"}),e.jsx("span",{className:"font-mono",children:(n.batchSize/n.servingSize).toFixed(0)})]})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Dosage Verification"]})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{children:"Target THC:"}),e.jsxs("span",{className:"font-mono",children:[n.targetThc.toFixed(1)," mg"]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{children:"Calculated THC:"}),e.jsxs("span",{className:"font-mono",children:[n.calculations.actualThc.toFixed(2)," mg"]})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"THC Variance:"}),e.jsxs(ve,{variant:Math.abs(k)<5?"default":"destructive",children:[k.toFixed(1),"%"]})]})]})})]})]})]})};function Se(){return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx(Ce,{title:"Interactive Cannabis Formulation Sheet",onSave:T=>{console.log("Formulation saved:",T)}})})}export{Se as FormulationPage};
