import{r,t as ce,m as de,v as I,j as e,R as oe,B as h,ag as xe,C as R,a as P,b as V,d as O,o as ue,I as v,Y as S,_ as E,$ as k,a0 as Q,a1 as i,D as A,ah as D,ai as he,a7 as me,a6 as je,f as B,q as ge,aj as T}from"./index-CDF1r-gK.js";import{T as fe,a as pe,b as w,c as N,d as be,e as c}from"./table-BtQ_kS4p.js";import{S as H}from"./save-BBPmqZUn.js";import{S as ve}from"./square-pen-D1rxitn8.js";function Se({agentType:m}){const[J,L]=r.useState(new Set),[M,F]=r.useState({}),[j,K]=r.useState(""),[g,X]=r.useState("all"),[f,Y]=r.useState("all"),[q,G]=r.useState(new Set),[W,_]=r.useState(!1),[o,x]=r.useState({category:"",difficulty:"beginner",state:"MULTI",question:"",expected_answer:"",tags:[]});ce();const{data:y,isLoading:Z,refetch:U}=de({queryKey:[`/api/agents/${m}/baseline-questions`],enabled:!!m}),p=r.useMemo(()=>!y||!y.questions?[]:y.questions.map(s=>({...s,expected_answer:s.expected_answer||s.expectedAnswer||""})),[y]),ee=I({mutationFn:async s=>{const a=await fetch(`/api/agents/${m}/baseline-questions/${s.questionId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s.updates)});if(!a.ok)throw new Error("Failed to update question");return a.json()},onSuccess:()=>{T({title:"Question Updated",description:"Baseline question has been successfully updated."}),U()},onError:s=>{T({title:"Update Failed",description:s.message||"Failed to update question",variant:"destructive"})}}),$=I({mutationFn:async s=>{const a=await fetch(`/api/agents/${m}/baseline-questions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to add question");return a.json()},onSuccess:()=>{T({title:"Question Added",description:"New baseline question has been successfully added."}),_(!1),x({category:"",difficulty:"beginner",state:"MULTI",question:"",expected_answer:"",tags:[]}),U()},onError:s=>{T({title:"Add Failed",description:s.message||"Failed to add question",variant:"destructive"})}}),se=(s,a)=>{L(n=>new Set(n).add(s)),F(n=>({...n,[s]:{...a}}))},z=s=>{L(a=>{const n=new Set(a);return n.delete(s),n}),F(a=>{const n={...a};return delete n[s],n})},ae=s=>{const a=M[s];a&&(ee.mutate({questionId:s,updates:a}),z(s))},b=(s,a,n)=>{F(t=>({...t,[s]:{...t[s],[a]:n}}))},te=s=>{G(a=>{const n=new Set(a);return n.has(s)?n.delete(s):n.add(s),n})},ne=s=>q.has(s),C=r.useMemo(()=>p.filter(s=>{const a=!j||s.question.toLowerCase().includes(j.toLowerCase())||s.expected_answer.toLowerCase().includes(j.toLowerCase()),n=!f||f==="all"||s.difficulty===f,t=!g||g==="all"||s.category===g;return a&&n&&t}),[p,j,f,g]),le=r.useMemo(()=>{const s={};return C.forEach(a=>{const n=a.category||"Uncategorized";s[n]||(s[n]=[]),s[n].push(a)}),s},[C]),re=r.useMemo(()=>{const s=new Set;return p.forEach(a=>s.add(a.category)),Array.from(s).sort()},[p]),ie=s=>{switch(s){case"beginner":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400";case"intermediate":return"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400";case"advanced":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400"}};return Z?e.jsxs("div",{className:"flex items-center justify-center min-h-64",children:[e.jsx(oe,{className:"h-8 w-8 animate-spin mr-3"}),e.jsx("span",{children:"Loading baseline questions..."})]}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Baseline Questions Editor"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Edit baseline questions and expected answers for ",m," agent"]})]}),e.jsxs(h,{onClick:()=>_(!0),className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Add Question"]})]}),e.jsxs(R,{children:[e.jsx(P,{children:e.jsx(V,{children:"Filters & Search"})}),e.jsx(O,{children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(v,{placeholder:"Search questions or answers...",value:j,onChange:s=>K(s.target.value),className:"pl-10"})]})}),e.jsxs(S,{value:g,onValueChange:X,children:[e.jsx(E,{className:"w-48",children:e.jsx(k,{placeholder:"Category"})}),e.jsxs(Q,{children:[e.jsx(i,{value:"all",children:"All Categories"}),re.map(s=>e.jsx(i,{value:s,children:s},s))]})]}),e.jsxs(S,{value:f,onValueChange:Y,children:[e.jsx(E,{className:"w-32",children:e.jsx(k,{placeholder:"Difficulty"})}),e.jsxs(Q,{children:[e.jsx(i,{value:"all",children:"All"}),e.jsx(i,{value:"beginner",children:"Beginner"}),e.jsx(i,{value:"intermediate",children:"Intermediate"}),e.jsx(i,{value:"advanced",children:"Advanced"})]})]})]})})]}),e.jsxs(R,{children:[e.jsx(P,{children:e.jsxs(V,{children:["Questions (",C.length," of ",p.length,")"]})}),e.jsx(O,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(fe,{children:[e.jsx(pe,{children:e.jsxs(w,{children:[e.jsx(N,{className:"min-w-[400px]",children:"Question & Expected Answer"}),e.jsx(N,{className:"w-32",children:"Category"}),e.jsx(N,{className:"w-24",children:"Difficulty"}),e.jsx(N,{className:"w-16",children:"State"}),e.jsx(N,{className:"w-24",children:"Actions"})]})}),e.jsxs(be,{children:[W&&e.jsxs(w,{className:"bg-blue-50/50 dark:bg-blue-900/20",children:[e.jsx(c,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Question:"}),e.jsx(A,{value:o.question||"",onChange:s=>x(a=>({...a,question:s.target.value})),placeholder:"Enter the question...",rows:3,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Expected Answer:"}),e.jsx(A,{value:o.expected_answer||"",onChange:s=>x(a=>({...a,expected_answer:s.target.value})),placeholder:"Enter the expected answer...",rows:4,className:"mt-1"})]})]})}),e.jsx(c,{children:e.jsx(v,{value:o.category||"",onChange:s=>x(a=>({...a,category:s.target.value})),placeholder:"Category"})}),e.jsx(c,{children:e.jsxs(S,{value:o.difficulty||"beginner",onValueChange:s=>x(a=>({...a,difficulty:s})),children:[e.jsx(E,{children:e.jsx(k,{})}),e.jsxs(Q,{children:[e.jsx(i,{value:"beginner",children:"Beginner"}),e.jsx(i,{value:"intermediate",children:"Intermediate"}),e.jsx(i,{value:"advanced",children:"Advanced"})]})]})}),e.jsx(c,{children:e.jsx(v,{value:o.state||"MULTI",onChange:s=>x(a=>({...a,state:s.target.value})),placeholder:"State",className:"w-16"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(h,{size:"sm",onClick:()=>$.mutate(o),disabled:!o.question||!o.expected_answer||$.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>_(!1),children:e.jsx(D,{className:"h-3 w-3"})})]})})]}),Object.entries(le).map(([s,a])=>{const n=ne(s);return e.jsxs(he.Fragment,{children:[e.jsx(w,{className:"bg-gray-50 dark:bg-gray-900/50 hover:bg-gray-100 dark:hover:bg-gray-800/50",children:e.jsx(c,{colSpan:5,className:"font-semibold",children:e.jsxs("button",{onClick:()=>te(s),className:"flex items-center gap-2 w-full text-left",children:[n?e.jsx(me,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"}),s," (",a.length," question",a.length!==1?"s":"",")"]})})}),!n&&a.map(t=>{const u=J.has(t.id),l=M[t.id];return e.jsxs(w,{className:u?"bg-blue-50/20 dark:bg-blue-900/10":"",children:[e.jsx(c,{children:u?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Question:"}),e.jsx(A,{value:(l==null?void 0:l.question)||t.question,onChange:d=>b(t.id,"question",d.target.value),rows:3,className:"mt-1 border-blue-300 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Expected Answer:"}),e.jsx(A,{value:(l==null?void 0:l.expected_answer)||t.expected_answer,onChange:d=>b(t.id,"expected_answer",d.target.value),rows:4,className:"mt-1 border-blue-300 focus:border-blue-500"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Question:"}),e.jsx("p",{className:"text-sm leading-relaxed",children:t.question})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Expected Answer:"}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:t.expected_answer})]})]})}),e.jsx(c,{children:u?e.jsx(v,{value:(l==null?void 0:l.category)||t.category,onChange:d=>b(t.id,"category",d.target.value),className:"border-blue-300 focus:border-blue-500"}):e.jsx(B,{variant:"outline",className:"text-xs",children:t.category})}),e.jsx(c,{children:u?e.jsxs(S,{value:(l==null?void 0:l.difficulty)||t.difficulty,onValueChange:d=>b(t.id,"difficulty",d),children:[e.jsx(E,{className:"border-blue-300 focus:border-blue-500",children:e.jsx(k,{})}),e.jsxs(Q,{children:[e.jsx(i,{value:"beginner",children:"Beginner"}),e.jsx(i,{value:"intermediate",children:"Intermediate"}),e.jsx(i,{value:"advanced",children:"Advanced"})]})]}):e.jsx(B,{className:`text-xs ${ie(t.difficulty)}`,children:t.difficulty})}),e.jsx(c,{children:u?e.jsx(v,{value:(l==null?void 0:l.state)||t.state,onChange:d=>b(t.id,"state",d.target.value),className:"w-16 border-blue-300 focus:border-blue-500"}):e.jsx(B,{variant:"outline",className:"text-xs",children:t.state})}),e.jsx(c,{children:u?e.jsxs("div",{className:"flex gap-1",children:[e.jsx(h,{size:"sm",onClick:()=>ae(t.id),className:"h-8 px-2 text-xs",children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>z(t.id),className:"h-8 px-2 text-xs",children:e.jsx(D,{className:"h-3 w-3"})})]}):e.jsx(h,{size:"sm",variant:"outline",onClick:()=>se(t.id,t),className:"h-8 px-2 text-xs",children:e.jsx(ve,{className:"h-3 w-3"})})})]},t.id)})]},`category-${s}`)}),C.length===0&&e.jsx(w,{children:e.jsx(c,{colSpan:5,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(ge,{className:"h-5 w-5"}),e.jsx("span",{children:"No questions found matching the current filters"})]})})})]})]})})})]})]})}export{Se as default};
